#library(MASS)
library(compiler)
enableJIT(3)
require(nmw)

setwd("c:/NMW2017/04-THEO")

head(Theoph, 20)
Theo = Theoph[,c("Subject", "Time", "conc")]
colnames(Theo) = c("ID" ,"TIME", "DV")
head(Theo, 20)

require(lattice)
xyplot(DV~TIME|ID, data=Theo, type="b", index.cond=list(order(as.numeric(levels(unique(Theo$ID))))))

DataAll = Theo

nTheta = 3
nEta = 3
nEps = 2

THETAinit = c(2, 50, 0.1)
OMinit = matrix(c(0.2, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.2), nrow=nEta, ncol=nEta) ; OMinit
SGinit = matrix(c(0.1, 0, 0, 0.1), nrow=nEps, ncol=nEps) ; SGinit

LB = rep(0, nTheta)
UB = rep(1000000, nTheta)

#######
METHOD = "ZERO"
InitStep(DataAll, THETAinit=THETAinit, OMinit=OMinit, SGinit=SGinit, nTheta=nTheta, LB=LB, UB=UB, METHOD=METHOD, PredFile="PRED.R")
(EstRes = EstStep())            # 9.148523 secs, JIT 6.009344 secs, 2017-02-21: 3.019122 secs
(CovRes = CovStep())            # 4.409762 secs

PostHocEta() # FinalPara from EstStep()

########
METHOD = "COND"
InitStep(DataAll, THETAinit=THETAinit, OMinit=OMinit, SGinit=SGinit, nTheta=nTheta, LB=LB, UB=UB, METHOD=METHOD, PredFile="PRED.R")
(EstRes = EstStep())            # 11.49719 mins, JIT 6.304511 mins, With deriv 10.27879 mins, 2017-02-21: 3.340101 mins
(CovRes = CovStep())            # 2.062185 mins, JIT 1.064711 mins, With deriv 1.739616 mins, 2017-02-21: 35.39151 secs
get("EBE", envir=e)


########
METHOD = "LAPL"
THETAinit = c(4, 50, 0.2)
InitStep(DataAll, THETAinit=THETAinit, OMinit=OMinit, SGinit=SGinit, nTheta=nTheta, LB=LB, UB=UB, METHOD=METHOD, PredFile="PRED.R")
(EstRes = EstStep())           # 7.354287 mins, JIT 4.583896 mins
(CovRes = CovStep())           # 2.340167 mins, JIT 1.481601 mins
get("EBE", envir=e)




## OUTPUT
> #######
> METHOD = "ZERO"
> InitStep(DataAll, THETAinit=THETAinit, OMinit=OMinit, SGinit=SGinit, nTheta=nTheta, LB=LB, UB=UB, METHOD=METHOD)
> (EstRes = EstStep())            # 9.148523 secs
$`Initial OFV`
[1] 141.3076

$Time
Time difference of 7.069404 secs

$Optim
$Optim$par
 [1]  0.560417595 -0.167835388  0.148962366  0.995143064  0.056166719  0.151227214 -1.032468520  0.005776723  0.110936472 -0.956899772 -0.205559306

$Optim$value
[1] 57.32106

$Optim$counts
function gradient
      74       74

$Optim$convergence
[1] 0

$Optim$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

$Optim$hessian
             [,1]        [,2]         [,3]         [,4]         [,5]         [,6]        [,7]        [,8]        [,9]        [,10]       [,11]
 [1,]  360.125167  -323.53038 -108.3543348  -69.8402087   621.409498  -10.3806396   2.3277994   54.279080  12.1718163   38.0437777  -1.2055874
 [2,] -323.530378  1611.58184  -61.6390748   89.6421258 -2039.215968  -91.5076954 -40.6712150 -228.183865 -46.5801017 -223.2295108 -43.2249902
 [3,] -108.354335   -61.63907  757.3212851   48.7772127   376.582257 -419.3326054   0.2745096   26.904788 -77.3391058  -35.6835106 -45.4265514
 [4,]  -69.840209    89.64213   48.7772127   81.6923582  -392.973664 -107.0493585   0.9316277   -2.550462  -1.8199372    0.8033797   1.7833190
 [5,]  621.409498 -2039.21597  376.5822566 -392.9736645  6114.008346  202.9468039 -17.2122104   65.327648   1.2530237  -13.1832881  27.4623536
 [6,]  -10.380640   -91.50770 -419.3326054 -107.0493585   202.946804  732.7779998  -0.1239811   -7.907867  13.7096944    2.3498272 -15.2968144
 [7,]    2.327799   -40.67121    0.2745096    0.9316277   -17.212210   -0.1239811  32.3757616   12.418355   0.3843557    7.0190575  -0.3519534
 [8,]   54.279080  -228.18386   26.9047879   -2.5504617    65.327648   -7.9078668  12.4183551  211.753887  13.9743567   -4.3449889  -6.6526851
 [9,]   12.171816   -46.58010  -77.3391058   -1.8199372     1.253024   13.7096944   0.3843557   13.974357  35.1993934   -0.2689586   5.4827781
[10,]   38.043778  -223.22951  -35.6835106    0.8033797   -13.183288    2.3498272   7.0190575   -4.344989  -0.2689586  225.0618094  34.4482721
[11,]   -1.205587   -43.22499  -45.4265514    1.7833190    27.462354  -15.2968144  -0.3519534   -6.652685   5.4827781   34.4482721  93.6733301


$`Original Parameter`
 [1]  3.16946754 38.25213463  0.10501808  1.19823329  0.13747849  0.03134899  0.37015672  0.04340042  0.25068582  0.01207782  0.05427434

> (CovRes = CovStep())
$`Standard Error`
 [1] 0.641076548 1.685217849 0.023072024 0.420617336 0.082197506 0.019812977 0.340273213 0.023052141 0.289524330 0.003576926 0.032078284

$`Covariance Matrix of Estimates`
               [,1]         [,2]          [,3]          [,4]          [,5]          [,6]          [,7]         [,8]          [,9]         [,10]         [,11]
 [1,]  0.4109791400  0.339158104  5.746694e-03  0.2058089796  2.003771e-03 -2.192524e-03  0.1215890930 9.971094e-04  0.0669924123  1.050012e-03 -4.972900e-03
 [2,]  0.3391581036  2.839959199  5.032608e-03  0.3376028579  3.490467e-02  1.280481e-02  0.1490892484 2.386563e-02  0.0573260798  1.807746e-03 -9.950374e-03
 [3,]  0.0057466940  0.005032608  5.323183e-04  0.0016294508 -1.041991e-03 -2.503964e-04  0.0071119003 6.271255e-05  0.0062260964  5.805488e-05 -4.790610e-04
 [4,]  0.2058089796  0.337602858  1.629451e-03  0.1769189437  1.951491e-02  3.207225e-03  0.0575731495 4.215845e-03  0.0179862500  5.143569e-04 -1.014500e-03
 [5,]  0.0020037715  0.034904668 -1.041991e-03  0.0195149059  6.756430e-03  1.504691e-03 -0.0101019812 8.584717e-04 -0.0130923912 -7.516776e-05  9.532950e-04
 [6,] -0.0021925239  0.012804814 -2.503964e-04  0.0032072251  1.504691e-03  3.925541e-04 -0.0028272762 2.326327e-04 -0.0032697948 -2.051327e-05  1.806783e-04
 [7,]  0.1215890930  0.149089248  7.111900e-03  0.0575731495 -1.010198e-02 -2.827276e-03  0.1157858596 3.116260e-03  0.0940102416  9.767199e-04 -3.860827e-03
 [8,]  0.0009971094  0.023865633  6.271255e-05  0.0042158448  8.584717e-04  2.326327e-04  0.0031162603 5.314012e-04  0.0018656793  2.786062e-05  2.199601e-04
 [9,]  0.0669924123  0.057326080  6.226096e-03  0.0179862500 -1.309239e-02 -3.269795e-03  0.0940102416 1.865679e-03  0.0838243376  8.055388e-04 -3.397016e-03
[10,]  0.0010500117  0.001807746  5.805488e-05  0.0005143569 -7.516776e-05 -2.051327e-05  0.0009767199 2.786062e-05  0.0008055388  1.279440e-05 -2.824858e-05
[11,] -0.0049728998 -0.009950374 -4.790610e-04 -0.0010145001  9.532950e-04  1.806783e-04 -0.0038608274 2.199601e-04 -0.0033970160 -2.824858e-05  1.029016e-03

$`Correlation Matrix of Estimates`
             [,1]       [,2]       [,3]        [,4]        [,5]       [,6]       [,7]      [,8]       [,9]      [,10]       [,11]
 [1,]  1.00000000  0.3139325  0.3885281  0.76325079  0.03802591 -0.1726175  0.5573872 0.0674717  0.3609364  0.4579038 -0.24181804
 [2,]  0.31393249  1.0000000  0.1294349  0.47628060  0.25198160  0.3835019  0.2599935 0.6143355  0.1174928  0.2998965 -0.18406542
 [3,]  0.38852814  0.1294349  1.0000000  0.16790684 -0.54943915 -0.5477629  0.9058832 0.1179119  0.9320626  0.7034659 -0.64728262
 [4,]  0.76325079  0.4762806  0.1679068  1.00000000  0.56444373  0.3848509  0.4022583 0.4347966  0.1476959  0.3418751 -0.07518891
 [5,]  0.03802591  0.2519816 -0.5494391  0.56444373  1.00000000  0.9239295 -0.3611771 0.4530604 -0.5501426 -0.2556601  0.36154099
 [6,] -0.17261746  0.3835019 -0.5477629  0.38485093  0.92392948  1.0000000 -0.4193636 0.5093423 -0.5700142 -0.2894510  0.28427926
 [7,]  0.55738717  0.2599935  0.9058832  0.40225834 -0.36117706 -0.4193636  1.0000000 0.3972782  0.9542504  0.8024764 -0.35370524
 [8,]  0.06747170  0.6143355  0.1179119  0.43479663  0.45306035  0.5093423  0.3972782 1.0000000  0.2795379  0.3378855  0.29745522
 [9,]  0.36093638  0.1174928  0.9320626  0.14769588 -0.55014259 -0.5700142  0.9542504 0.2795379  1.0000000  0.7778420 -0.36576438
[10,]  0.45790382  0.2998965  0.7034659  0.34187507 -0.25566012 -0.2894510  0.8024764 0.3378855  0.7778420  1.0000000 -0.24619291
[11,] -0.24181804 -0.1840654 -0.6472826 -0.07518891  0.36154099  0.2842793 -0.3537052 0.2974552 -0.3657644 -0.2461929  1.00000000

$`Inverse Covariance Matrix of Estimates`
             [,1]         [,2]        [,3]        [,4]        [,5]         [,6]         [,7]        [,8]         [,9]      [,10]        [,11]
 [1,]   106.16084    -68.57396    6449.005    335.8698   -2554.409    -386.8783   -1202.1635   10794.576    -49.38180   11656.77   -1043.1150
 [2,]   -68.57396     58.03937   -4878.746   -302.1420    2175.297     570.2221     939.9968   -8973.046     87.68158  -10122.85    1001.7463
 [3,]  6449.00484  -4878.74576  589180.785  26966.6046 -188642.067  -66147.0541  -90186.4599  795473.358 -10522.25821  899033.04  -47225.4350
 [4,]   335.86980   -302.14198   26966.605   1681.5577  -11681.346   -3404.8874   -5086.8916   47387.232   -442.61238   53311.64   -4879.5430
 [5,] -2554.40936   2175.29721 -188642.067 -11681.3458   84767.303   13635.4937   35747.1403 -336778.087   3308.44866 -378718.18   35063.0382
 [6,]  -386.87834    570.22212  -66147.054  -3404.8874   13635.494   72186.1313   10923.7405 -116902.589   2827.91844 -138707.31   15687.7558
 [7,] -1202.16347    939.99682  -90186.460  -5086.8916   35747.140   10923.7405   16640.0636 -149635.848    965.72088 -166637.08   14275.7790
 [8,] 10794.57563  -8973.04595  795473.358  47387.2319 -336778.087 -116902.5892 -149635.8484 1416416.018 -14025.68934 1587796.17 -151936.7307
 [9,]   -49.38180     87.68158  -10522.258   -442.6124    3308.449    2827.9184     965.7209  -14025.689    954.65492  -20047.20     935.2978
[10,] 11656.77309 -10122.84541  899033.042  53311.6423 -378718.179 -138707.3101 -166637.0779 1587796.168 -20047.19968 2031529.87 -170271.3400
[11,] -1043.11496   1001.74633  -47225.435  -4879.5430   35063.038   15687.7558   14275.7790 -151936.731    935.29776 -170271.34   28036.5542

$`Eigen Values`
 [1] 0.0002519304 0.0096729019 0.0108358600 0.0233184629 0.0520725546 0.2982375254 0.5047778962 0.9114702307 1.2088052675 3.2082380728 4.7723192975

$`R Matrix`
             [,1]         [,2]         [,3]         [,4]         [,5]        [,6]        [,7]        [,8]         [,9]        [,10]        [,11]
 [1,]   17.924787   -1.3343223  -162.767657   -4.1309678    21.546400    10.22593  -11.022691    52.30435     7.044856    248.45648    -1.752134
 [2,]   -1.334322    0.5507357    -7.672313    0.1118322    -1.462877   -16.52104    2.984907   -18.24571    -2.233895   -120.79912    -5.205228
 [3,] -162.767657   -7.6723134 34333.363102   86.0269177   433.962360    13.38780  -90.741304   956.48187 -1350.939652  -7033.21250 -1992.414258
 [4,]   -4.130968    0.1118322    86.026918   28.6263072  -177.270121   272.93707  -52.926189   164.31581    24.453697     50.23288     6.012060
 [5,]   21.546400   -1.4628768   433.962360 -177.2701210  1930.445760 -4270.87872  210.709314 -1421.95755   -43.763561  -1013.85665   124.417550
 [6,]   10.225935  -16.5210416    13.387803  272.9370711 -4270.878723 16610.43903 -139.814431  1113.59940    18.726090   4680.59981   -46.029625
 [7,]  -11.022691    2.9849070   -90.741304  -52.9261889   210.709314  -139.81443  213.228941  -555.99367  -151.083276     96.25914   -62.941131
 [8,]   52.304348  -18.2457146   956.481866  164.3158080 -1421.957553  1113.59940 -555.993668  4043.51424   130.794814   -555.76904  -201.267591
 [9,]    7.044856   -2.2338947 -1350.939652   24.4536966   -43.763561    18.72609 -151.083276   130.79481   236.875933    -20.42602    92.656854
[10,]  248.456484 -120.7991175 -7033.212498   50.2328753 -1013.856655  4680.59981   96.259141  -555.76904   -20.426020 192857.05245  6568.909242
[11,]   -1.752134   -5.2052276 -1992.414258    6.0120602   124.417550   -46.02963  -62.941131  -201.26759    92.656854   6568.90924  3974.804344

$`S Matrix`
              [,1]         [,2]        [,3]         [,4]        [,5]        [,6]          [,7]         [,8]         [,9]       [,10]        [,11]
 [1,]    78.316509   -4.6468525  -1295.1319   -11.873084   142.72164  -145.83516   -26.7073996     44.37513    13.946014   2039.6480    279.50083
 [2,]    -4.646852    0.7648878     64.3659     2.623533   -28.61925    29.49059     0.2387058     10.76141    -4.404221   -397.4746    -47.31112
 [3,] -1295.131932   64.3658974 183632.3992  -230.636223   840.38238  9000.10228  3794.2771576 -10813.66486 -6396.751485  -4148.0282 -60483.51086
 [4,]   -11.873084    2.6235331   -230.6362    18.368715  -171.71678   291.77959   -19.6869526     84.84179     3.480213  -1170.2797    -22.72921
 [5,]   142.721641  -28.6192528    840.3824  -171.716780  2005.81535 -3809.95380    51.7614008   -765.19105    87.901276   8916.7755    670.78860
 [6,]  -145.835156   29.4905925   9000.1023   291.779587 -3809.95380 12023.28599   188.5688247    667.62859  -711.894500  -3829.1364  -3489.01485
 [7,]   -26.707400    0.2387058   3794.2772   -19.686953    51.76140   188.56882   129.3349762   -292.66399  -155.764416   1796.9712  -1105.92314
 [8,]    44.375131   10.7614111 -10813.6649    84.841787  -765.19105   667.62859  -292.6639940   1121.03188   294.247287 -10631.8768   2773.71183
 [9,]    13.946014   -4.4042212  -6396.7515     3.480213    87.90128  -711.89450  -155.7644161    294.24729   327.282120   1812.2112   2358.45499
[10,]  2039.648014 -397.4745820  -4148.0282 -1170.279693  8916.77554 -3829.13638  1796.9712283 -10631.87680  1812.211242 419517.6520  18067.42702
[11,]   279.500826  -47.3111200 -60483.5109   -22.729209   670.78860 -3489.01485 -1105.9231445   2773.71183  2358.454989  18067.4270  24042.66045

>
> PostHocEta() # FinalPara from EstStep()
      ID       ETA1         ETA2        ETA3
 [1,]  1 -0.6974335 -0.243282943 -0.69037780
 [2,]  2 -0.4541861 -0.147886223 -0.06687408
 [3,]  3 -0.3057577 -0.113561181 -0.20461680
 [4,]  4 -1.0816386 -0.197886605 -0.18247171
 [5,]  5 -0.8125117 -0.304776229 -0.23195437
 [6,]  6 -1.1279804  0.047074816 -0.04894822
 [7,]  7 -1.5534136 -0.110439192 -0.11125627
 [8,]  8 -0.7317621 -0.034820925 -0.19527879
 [9,]  9  0.7432273  0.020074101 -0.19511858
[10,] 10 -1.3896142 -0.322504557 -0.44454017
[11,] 11  0.1547899  0.003895174 -0.07657179
[12,] 12 -1.3356243 -0.369231408 -0.10314531
>
> ########
> METHOD = "COND"
> (EstRes = EstStep())            # 11.49719 mins
$`Initial OFV`
[1] 188.7005

$Time
Time difference of 6.775921 mins

$Optim
$Optim$par
 [1] -0.194940103 -0.331944406 -0.036138549  0.488967799  0.038696665 -0.004411456 -1.156225225  0.089293324 -1.376740445 -0.769434121 -0.023736642

$Optim$value
[1] 92.21507

$Optim$counts
function gradient
     107      107

$Optim$convergence
[1] 1

$Optim$message
[1] "NEW_X"

$Optim$hessian
              [,1]        [,2]        [,3]         [,4]         [,5]         [,6]        [,7]        [,8]       [,9]      [,10]       [,11]
 [1,]   84.1006277 -217.168659   60.248932   -2.3858643   -27.089495    26.135451   2.3302663  -10.982057  0.4166918  11.139626  -0.3109428
 [2,] -217.1686587 1421.112729 -196.823726   -4.8893790   304.539451  -225.105442 -14.0164400   83.431916  1.3209927 -65.799600  -4.7869213
 [3,]   60.2489318 -196.823726  663.340511    8.3212828  -222.975303   153.790173   8.7817929  -62.861392 -2.2054087  18.717187   2.5438974
 [4,]   -2.3858643   -4.889379    8.321283   52.9064368  -333.402362   123.150439   0.5169972   -5.737978  0.5842184   3.287405   2.6762539
 [5,]  -27.0894953  304.539451 -222.975303 -333.4023623  7247.642731 -1286.057718 -12.0176829  149.550653 -8.6840214 -14.670481 -18.6251130
 [6,]   26.1354509 -225.105442  153.790173  123.1504389 -1286.057718  3352.593116 -25.5294953  176.855954 17.5389342   6.707133   9.4023764
 [7,]    2.3302663  -14.016440    8.781793    0.5169972   -12.017683   -25.529495  22.5570114   28.372918 -0.9001065   3.597411   1.4795712
 [8,]  -10.9820570   83.431916  -62.861392   -5.7379784   149.550653   176.855954  28.3729181 1144.706831 31.3967972  -7.081256 -14.7648747
 [9,]    0.4166918    1.320993   -2.205409    0.5842184    -8.684021    17.538934  -0.9001065   31.396797  2.3613435   2.989329   1.2289345
[10,]   11.1396264  -65.799600   18.717187    3.2874052   -14.670481     6.707133   3.5974110   -7.081256  2.9893290 216.056266  72.5980973
[11,]   -0.3109428   -4.786921    2.543897    2.6762539   -18.625113     9.402376   1.4795712  -14.764875  1.2289345  72.598097  50.3932363


$`Original Parameter`
 [1]  1.489153129 32.462842822  0.087272172  0.435394695  0.057095266  0.019647560 -0.006508913  0.011858557  0.020340512  0.017571916  0.078077108

> StartTime = Sys.time()
> (CovRes = CovStep())
$`Standard Error`
 [1] 0.339022598 1.743762625 0.004301141 0.207905327 0.034478248 0.008809194 0.020233605 0.008085455 0.019507596 0.011455182 0.105138924

$`Covariance Matrix of Estimates`
               [,1]         [,2]          [,3]          [,4]          [,5]          [,6]          [,7]          [,8]          [,9]         [,10]         [,11]
 [1,]  1.149363e-01  0.347853821 -2.961952e-04  4.165922e-02  5.175173e-03 -5.704335e-04  1.175073e-03  2.579302e-04 -2.651287e-05 -1.349941e-04 -0.0030796027
 [2,]  3.478538e-01  3.040708092  1.294508e-03  1.215183e-01 -7.322161e-03 -1.840686e-03  5.166572e-03  1.620857e-03 -1.175008e-02  5.008664e-03 -0.0780511164
 [3,] -2.961952e-04  0.001294508  1.849981e-05  7.537686e-05  1.210764e-05  1.594910e-05 -1.753244e-05 -2.687677e-05 -6.323285e-05  3.071147e-05 -0.0003249645
 [4,]  4.165922e-02  0.121518284  7.537686e-05  4.322463e-02  5.741791e-03  4.603857e-04 -8.814490e-04 -3.683213e-04 -8.390473e-04 -2.636125e-04 -0.0037762749
 [5,]  5.175173e-03 -0.007322161  1.210764e-05  5.741791e-03  1.188750e-03  1.387628e-04 -5.524672e-05 -1.119831e-04 -1.077639e-04 -5.101814e-05 -0.0003469017
 [6,] -5.704335e-04 -0.001840686  1.594910e-05  4.603857e-04  1.387628e-04  7.760190e-05 -2.527409e-05 -3.553822e-05 -6.530737e-05  1.335250e-05 -0.0002955590
 [7,]  1.175073e-03  0.005166572 -1.753244e-05 -8.814490e-04 -5.524672e-05 -2.527409e-05  4.093988e-04  7.123929e-05 -7.283513e-05  5.268634e-05 -0.0005900861
 [8,]  2.579302e-04  0.001620857 -2.687677e-05 -3.683213e-04 -1.119831e-04 -3.553822e-05  7.123929e-05  6.537459e-05  1.004125e-04 -4.337273e-05  0.0004568403
 [9,] -2.651287e-05 -0.011750084 -6.323285e-05 -8.390473e-04 -1.077639e-04 -6.530737e-05 -7.283513e-05  1.004125e-04  3.805463e-04 -1.749474e-04  0.0019914860
[10,] -1.349941e-04  0.005008664  3.071147e-05 -2.636125e-04 -5.101814e-05  1.335250e-05  5.268634e-05 -4.337273e-05 -1.749474e-04  1.312212e-04 -0.0010561795
[11,] -3.079603e-03 -0.078051116 -3.249645e-04 -3.776275e-03 -3.469017e-04 -2.955590e-04 -5.900861e-04  4.568403e-04  1.991486e-03 -1.056179e-03  0.0110541933

$`Correlation Matrix of Estimates`
              [,1]       [,2]        [,3]        [,4]        [,5]       [,6]        [,7]        [,8]         [,9]       [,10]       [,11]
 [1,]  1.000000000  0.5884110 -0.20312609  0.59103998  0.44274229 -0.1910030  0.17130224  0.09409555 -0.004008892 -0.03476034 -0.08639777
 [2,]  0.588410976  1.0000000  0.17259712  0.33518814 -0.12178862 -0.1198274  0.14643397  0.11496164 -0.345421896  0.25074516 -0.42572409
 [3,] -0.203126093  0.1725971  1.00000000  0.08429246  0.08164522  0.4209363 -0.20145847 -0.77283875 -0.753625030  0.62332557 -0.71860254
 [4,]  0.591039985  0.3351881  0.08429246  1.00000000  0.80100752  0.2513738 -0.20953584 -0.21910724 -0.206879313 -0.11068743 -0.17275652
 [5,]  0.442742289 -0.1217886  0.08164522  0.80100752  1.00000000  0.4568690 -0.07919323 -0.40170090 -0.160222781 -0.12917470 -0.09569687
 [6,] -0.191002996 -0.1198274  0.42093628  0.25137381  0.45686895  1.0000000 -0.14179670 -0.49894767 -0.380033855  0.13231965 -0.31911297
 [7,]  0.171302239  0.1464340 -0.20145847 -0.20953584 -0.07919323 -0.1417967  1.00000000  0.43545353 -0.184528684  0.22731220 -0.27738219
 [8,]  0.094095551  0.1149616 -0.77283875 -0.21910724 -0.40170090 -0.4989477  0.43545353  1.00000000  0.636618750 -0.46828503  0.53739845
 [9,] -0.004008892 -0.3454219 -0.75362503 -0.20687931 -0.16022278 -0.3800339 -0.18452868  0.63661875  1.000000000 -0.78289190  0.97097934
[10,] -0.034760343  0.2507452  0.62332557 -0.11068743 -0.12917470  0.1323196  0.22731220 -0.46828503 -0.782891899  1.00000000 -0.87694470
[11,] -0.086397766 -0.4257241 -0.71860254 -0.17275652 -0.09569687 -0.3191130 -0.27738219  0.53739845  0.970979343 -0.87694470  1.00000000

$`Inverse Covariance Matrix of Estimates`
              [,1]         [,2]         [,3]         [,4]         [,5]         [,6]         [,7]         [,8]         [,9]         [,10]        [,11]
 [1,]    270.98541   -30.464558    13472.031    468.75719   -3541.8600    6472.8661    2557.2740    4710.4424   -18689.129    14249.8885    5148.8089
 [2,]    -30.46456     5.787497    -1169.694    -78.70143     604.4946    -714.9155    -396.4418     163.9476     1334.494     -995.6548    -392.5256
 [3,]  13472.03087 -1169.694371  1018867.273  20576.97067 -136362.9024  323574.9562  120460.4232  469875.3966 -1150572.758   904215.4666  317536.5940
 [4,]    468.75719   -78.701433    20576.971   2670.95193  -17500.7848   19534.4957   17550.1605  -27338.8551   -34566.858    36406.7418   12837.9782
 [5,]  -3541.86001   604.494580  -136362.902 -17500.78478  119868.9738 -133440.1220 -113262.9187  179024.3347   223531.806  -224577.6863  -81684.7313
 [6,]   6472.86614  -714.915501   323574.956  19534.49569 -133440.1220  221542.2812  124451.8086  -23001.3000  -516353.755   454794.8694  158748.9519
 [7,]   2557.27401  -396.441827   120460.423  17550.16053 -113262.9187  124451.8086  126063.5943 -217783.5276  -213759.263   239183.6237   84315.8845
 [8,]   4710.44241   163.947611   469875.397 -27338.85508  179024.3347  -23001.3000 -217783.5276  995632.2459  -534617.401   242580.5900   78666.7752
 [9,] -18689.12871  1334.494059 -1150572.758 -34566.85807  223531.8062 -516353.7554 -213759.2629 -534617.4013  1844895.455 -1469090.8753 -510259.1930
[10,]  14249.88853  -995.654781   904215.467  36406.74179 -224577.6863  454794.8694  239183.6237  242580.5900 -1469090.875  1284286.1249  431187.7800
[11,]   5148.80892  -392.525621   317536.594  12837.97822  -81684.7313  158748.9519   84315.8845   78666.7752  -510259.193   431187.7800  148529.2820

$`Eigen Values`
 [1] 0.0003772316 0.0037971351 0.0261129674 0.1308037861 0.2289590661 0.2857529502 0.5795207861 1.0183171935 2.1063604658 2.3701987134 4.2497997047

$`R Matrix`
              [,1]        [,2]        [,3]          [,4]        [,5]        [,6]         [,7]         [,8]         [,9]       [,10]        [,11]
 [1,]  19.15923465  -2.2484480   232.56593    0.09406176   -14.50677    30.68055     7.355079   -12.189326    -5.814696   111.15406   -0.4474353
 [2,]  -2.24844798   0.6744493   -34.86151   -0.51629377     6.16706   -11.08879    -2.871589     4.683234     2.045415   -27.90408   -0.4738645
 [3,] 232.56592605 -34.8615051 43567.71496  157.00252584 -1486.46933  2344.19042   639.599528  -534.112557  -945.817721  3070.72447   81.7393815
 [4,]   0.09406176  -0.5162938   157.00253   68.92388933  -356.77526   385.48246   103.057914  -225.429268    61.737380   178.60250   27.4723599
 [5,] -14.50676650   6.1670598 -1486.46933 -356.77526265  3179.44913 -5041.71062  -539.708169  1986.181445  -434.904198 -1783.19112 -248.6442818
 [6,]  30.68055110 -11.0887886  2344.19042  385.48245942 -5041.71062 16830.50461   359.564808 -3259.974960   631.182610  5839.24703  735.1706766
 [7,]   7.35507894  -2.8715888   639.59953  103.05791375  -539.70817   359.56481  1357.854639 -3229.518031  1136.221258  1075.76693  163.2643921
 [8,] -12.18932581   4.6832337  -534.11256 -225.42926792  1986.18144 -3259.97496 -3229.518031 20220.785658 -4126.911390 -7133.31091 -997.5374472
 [9,]  -5.81469620   2.0454155  -945.81772   61.73737978  -434.90420   631.18261  1136.221258 -4126.911390  5768.477346  3064.38595  322.1050096
[10,] 111.15405562 -27.9040795  3070.72447  178.60249843 -1783.19112  5839.24703  1075.766928 -7133.310905  3064.385952 87540.27220 6602.0818512
[11,]  -0.44743526  -0.4738645    81.73938   27.47235987  -248.64428   735.17068   163.264392  -997.537447   322.105010  6602.08185 1029.2364998

$`S Matrix`
             [,1]         [,2]         [,3]        [,4]        [,5]        [,6]        [,7]         [,8]          [,9]       [,10]       [,11]
 [1,]   22.304283   -2.2284735    241.50205   -3.511112   135.44279  -299.58750   31.887156    -86.28797    -40.353806    351.1547   -40.87728
 [2,]   -2.228474    0.6562288    -29.86136    2.940106   -22.12192    18.08227   -6.374189     46.19950     -7.343295   -163.1136   -10.30463
 [3,]  241.502052  -29.8613618  42583.20914  274.185003 -2457.84022  8825.50226 -444.811608  -7957.26245 -14784.615243  37175.0971 -6185.08493
 [4,]   -3.511112    2.9401058    274.18500   41.052217  -181.28894   204.94797  -48.675400    240.80693   -214.010140   -776.4708  -145.84219
 [5,]  135.442793  -22.1219223  -2457.84022 -181.288943  2380.23844 -5327.89218  401.331928   -134.64674    995.095181  -5256.2642   114.71433
 [6,] -299.587500   18.0822687   8825.50226  204.947966 -5327.89218 17103.05567 -673.110405  -4150.74392  -2202.615287  20155.2058   294.94737
 [7,]   31.887156   -6.3741893   -444.81161  -48.675400   401.33193  -673.11040  163.508362   -338.06618    555.522973   1662.5731   272.02688
 [8,]  -86.287973   46.1995045  -7957.26245  240.806932  -134.64674 -4150.74392 -338.066176   8414.87331   -687.599589 -26428.7783 -1826.21441
 [9,]  -40.353806   -7.3432945 -14784.61524 -214.010140   995.09518 -2202.61529  555.522973   -687.59959   8818.068673   -775.4678  4583.22919
[10,]  351.154735 -163.1135595  37175.09708 -776.470780 -5256.26423 20155.20583 1662.573088 -26428.77831   -775.467776 267914.0233 10712.83708
[11,]  -40.877279  -10.3046292  -6185.08493 -145.842191   114.71433   294.94737  272.026876  -1826.21441   4583.229190  10712.8371  2986.69984

> difftime(Sys.time(), StartTime) # 2.062185 mins
Time difference of 1.217003 mins
>
> EBE
      ID        ETA1         ETA2        ETA3
 [1,]  1 -0.10401590 -0.191423897 -0.28256437
 [2,]  2  0.32949799  0.055309239  0.04672762
 [3,]  3  0.41095506  0.043662043 -0.01186323
 [4,]  4 -0.34489095 -0.042386082  0.01662295
 [5,]  5 -0.03234923 -0.110453662 -0.09195249
 [6,]  6 -0.47063352  0.139549430  0.22850628
 [7,]  7 -0.85930212  0.003593187  0.14449200
 [8,]  8 -0.06322124  0.072204606  0.07579691
 [9,]  9  1.33187187  0.177049754 -0.01259366
[10,] 10 -0.71220132 -0.214552755 -0.14871462
[11,] 11  0.86499270  0.176120084  0.07820830
[12,] 12 -0.50019069 -0.136883448 -0.02357551
>
>
> METHOD = "LAPL"
> (EstRes = EstStep())
$`Initial OFV`
[1] 176.8263

$Time
Time difference of 7.354287 mins

$Optim
$Optim$par
 [1] -0.275902322 -0.335635067  0.001964436  0.476003790  0.041576385  0.018744036  0.188889730 -0.031383125  0.076329190 -0.900723888 -0.092285501

$Optim$value
[1] 64.26478

$Optim$counts
function gradient
      51       51

$Optim$convergence
[1] 0

$Optim$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F <= FACTR*EPSMCH"

$Optim$hessian
             [,1]       [,2]        [,3]        [,4]        [,5]       [,6]        [,7]        [,8]       [,9]      [,10]       [,11]
 [1,]  2808390.67 -321364.71  -477054.69 -1116676.45  143586.352   90480.63 -2195889.61  -30441.924   88239.21   92413.51   440553.27
 [2,]  -321364.71 2224435.82   899819.59   404852.60  -44196.107 -305475.29   329419.64   98392.496 -292053.53 -300457.02  -965919.48
 [3,]  -477054.69  899819.59  2424954.56   616246.98  -63135.638 -210478.05   489958.46   68740.294 -201440.89 -207063.26 -1736521.36
 [4,] -1116676.45  404852.60   616246.98  2701618.52 -115490.911 -109883.67  1182116.89   37638.917 -109445.90 -112479.00  -563334.38
 [5,]   143586.35  -44196.11   -63135.64  -115490.91 3783620.427   12886.65  -139803.77   -4515.832   12501.76   12914.06    58973.21
 [6,]    90480.63 -305475.29  -210478.05  -109883.67   12886.650 1606640.17   -90896.62 -346185.676 2226300.91 1592580.42   221822.69
 [7,] -2195889.61  329419.64   489958.46  1182116.89 -139803.766  -90896.62  2795987.21   31185.478  -90508.73  -93013.54  -450836.14
 [8,]   -30441.92   98392.50    68740.29    37638.92   -4515.832 -346185.68    31185.48 1060291.406 -361155.27 -350448.64   -69602.52
 [9,]    88239.21 -292053.53  -201440.89  -109445.90   12501.758 2226300.91   -90508.73 -361155.268 1592989.01 1646265.90   212011.01
[10,]    92413.51 -300457.02  -207063.26  -112479.00   12914.057 1592580.42   -93013.54 -350448.640 1646265.90 1615735.92   226219.26
[11,]   440553.27 -965919.48 -1736521.36  -563334.38   58973.207  221822.69  -450836.14  -69602.524  212011.01  226219.26  2367615.40


$`Original Parameter`
 [1]  1.37333966 32.34325816  0.09066167  0.42425087  0.06055404  0.18782726  0.02729980 -0.01325371  0.13056640  0.01351395  0.06807426

> StartTime = Sys.time()
> (CovRes = CovStep())
$`Standard Error`
 [1] 1.683094e-02 5.729056e-01 1.716992e-04 9.929850e-04 1.337649e-05 4.760572e-04 4.229700e-05 1.829111e-04 2.431557e-04 3.603181e-05 6.037338e-05

$`Covariance Matrix of Estimates`
               [,1]          [,2]          [,3]          [,4]          [,5]          [,6]          [,7]          [,8]          [,9]         [,10]         [,11]
 [1,]  2.832805e-04 -9.641969e-03  2.876644e-06  1.669105e-05 -2.058006e-07  8.006834e-06 -7.109349e-07  3.074045e-06  4.083690e-06  6.042747e-07  1.007822e-06
 [2,] -9.641969e-03  3.282208e-01 -9.790919e-05 -5.682119e-04  6.992258e-06 -2.725781e-04  2.420523e-05 -1.046726e-04 -1.390531e-04 -2.058266e-05 -3.433408e-05
 [3,]  2.876644e-06 -9.790919e-05  2.948063e-08  1.688160e-07 -2.146042e-09  8.109193e-08 -7.214371e-09  3.111633e-08  4.128548e-08  6.120955e-09  1.015538e-08
 [4,]  1.669105e-05 -5.682119e-04  1.688160e-07  9.860193e-07 -1.186615e-08  4.726500e-07 -4.192190e-08  1.815503e-07  2.413645e-07  3.564991e-08  5.968438e-08
 [5,] -2.058006e-07  6.992258e-06 -2.146042e-09 -1.186615e-08  1.789305e-10 -5.722608e-09  5.116874e-10 -2.187022e-09 -2.885724e-09 -4.359197e-10 -7.001088e-10
 [6,]  8.006834e-06 -2.725781e-04  8.109193e-08  4.726500e-07 -5.722608e-09  2.266305e-07 -2.011118e-08  8.705006e-08  1.157041e-07  1.709875e-08  2.860288e-08
 [7,] -7.109349e-07  2.420523e-05 -7.214371e-09 -4.192190e-08  5.116874e-10 -2.011118e-08  1.789036e-09 -7.730043e-09 -1.026861e-08 -1.517602e-09 -2.541456e-09
 [8,]  3.074045e-06 -1.046726e-04  3.111633e-08  1.815503e-07 -2.187022e-09  8.705006e-08 -7.730043e-09  3.345647e-08  4.446930e-08  6.572385e-09  1.100931e-08
 [9,]  4.083690e-06 -1.390531e-04  4.128548e-08  2.413645e-07 -2.885724e-09  1.157041e-07 -1.026861e-08  4.446930e-08  5.912469e-08  8.732527e-09  1.464217e-08
[10,]  6.042747e-07 -2.058266e-05  6.120955e-09  3.564991e-08 -4.359197e-10  1.709875e-08 -1.517602e-09  6.572385e-09  8.732527e-09  1.298292e-09  2.160731e-09
[11,]  1.007822e-06 -3.433408e-05  1.015538e-08  5.968438e-08 -7.001088e-10  2.860288e-08 -2.541456e-09  1.100931e-08  1.464217e-08  2.160731e-09  3.644946e-09

$`Correlation Matrix of Estimates`
            [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]       [,8]       [,9]      [,10]      [,11]
 [1,]  1.0000000 -0.9999409  0.9954269  0.9986943 -0.9141051  0.9992941 -0.9986469  0.9985318  0.9978378  0.9964143  0.9918139
 [2,] -0.9999409  1.0000000 -0.9953413 -0.9988139  0.9124146 -0.9994218  0.9988876 -0.9988726 -0.9981901 -0.9970852 -0.9926517
 [3,]  0.9954269 -0.9953413  1.0000000  0.9901536 -0.9343891  0.9920878 -0.9933917  0.9907862  0.9888820  0.9893836  0.9796751
 [4,]  0.9986943 -0.9988139  0.9901536  1.0000000 -0.8933572  0.9998569 -0.9981335  0.9995726  0.9996462  0.9963906  0.9955715
 [5,] -0.9141051  0.9124146 -0.9343891 -0.8933572  1.0000000 -0.8986543  0.9043843 -0.8938629 -0.8872137 -0.9044369 -0.8669178
 [6,]  0.9992941 -0.9994218  0.9920878  0.9998569 -0.8986543  1.0000000 -0.9987775  0.9997005  0.9995511  0.9968252  0.9951881
 [7,] -0.9986469  0.9988876 -0.9933917 -0.9981335  0.9043843 -0.9987775  1.0000000 -0.9991536 -0.9984301 -0.9957774 -0.9952393
 [8,]  0.9985318 -0.9988726  0.9907862  0.9995726 -0.8938629  0.9997005 -0.9991536  1.0000000  0.9998521  0.9972334  0.9969523
 [9,]  0.9978378 -0.9981901  0.9888820  0.9996462 -0.8872137  0.9995511 -0.9984301  0.9998521  1.0000000  0.9967112  0.9974143
[10,]  0.9964143 -0.9970852  0.9893836  0.9963906 -0.9044369  0.9968252 -0.9957774  0.9972334  0.9967112  1.0000000  0.9932738
[11,]  0.9918139 -0.9926517  0.9796751  0.9955715 -0.8669178  0.9951881 -0.9952393  0.9969523  0.9974143  0.9932738  1.0000000

$`Inverse Covariance Matrix of Estimates`
               [,1]         [,2]          [,3]          [,4]          [,5]          [,6]          [,7]          [,8]          [,9]         [,10]         [,11]
 [1,]   30899567516   1538981189  5.282463e+11  1.104796e+11 -6.109762e+11  1.095519e+10 -4.772603e+11 -2.584710e+11  2.867290e+11  2.067919e+12  5.390423e+11
 [2,]    1538981190     78709789  2.747383e+10  5.907701e+09 -3.574027e+10  9.925408e+08 -2.732203e+10 -1.647106e+10  1.718208e+10  1.055827e+11  2.704318e+10
 [3,]  528246267874  27473826196  9.732772e+12  2.149539e+12 -1.367963e+13  2.692634e+11 -1.014667e+13 -6.687424e+12  6.901233e+12  3.673661e+13  9.302468e+12
 [4,]  110479645489   5907700857  2.149539e+12  5.166719e+11 -3.264659e+12  1.648732e+10 -2.770069e+12 -1.963541e+12  1.778317e+12  8.030949e+12  1.990119e+12
 [5,] -610976171099 -35740266666 -1.367963e+13 -3.264659e+12  3.025570e+13  4.810934e+11  1.287182e+13  1.349418e+13 -1.742041e+13 -4.382258e+13 -9.944750e+12
 [6,]   10955191823    992540757  2.692634e+11  1.648731e+10  4.810935e+11  1.117763e+12 -2.407306e+12 -5.345687e+11 -1.404916e+12  2.498717e+12  7.197103e+11
 [7,] -477260280729 -27322032790 -1.014667e+13 -2.770069e+12  1.287182e+13 -2.407306e+12  2.774007e+13  1.708470e+13 -6.545749e+12 -4.363154e+13 -1.051131e+13
 [8,] -258471027052 -16471062829 -6.687424e+12 -1.963541e+12  1.349418e+13 -5.345687e+11  1.708470e+13  1.390080e+13 -8.961270e+12 -2.472728e+13 -5.530656e+12
 [9,]  286729021862  17182076421  6.901233e+12  1.778317e+12 -1.742041e+13 -1.404916e+12 -6.545749e+12 -8.961270e+12  1.201038e+13  2.022034e+13  4.169580e+12
[10,] 2067918794399 105582744950  3.673661e+13  8.030949e+12 -4.382258e+13  2.498717e+12 -4.363154e+13 -2.472728e+13  2.022034e+13  1.458060e+14  3.749565e+13
[11,]  539042281919  27043176057  9.302468e+12  1.990119e+12 -9.944749e+12  7.197103e+11 -1.051131e+13 -5.530656e+12  4.169580e+12  3.749565e+13  1.002823e+13

$`Eigen Values`
 [1] 2.802367e-08 1.146898e-06 2.497676e-06 9.333038e-06 3.697373e-05 5.136531e-04 3.359154e-03 4.171729e-03 8.705796e-03 1.884868e-01 1.079471e+01

$`R Matrix`
              [,1]         [,2]          [,3]         [,4]         [,5]         [,6]         [,7]          [,8]         [,9]        [,10]        [,11]
 [1,]   33304.7943   -630.90073   -244576.181   -56081.117   -307429.69  -122511.586    88146.877     9745.3705  -100547.436   -974044.89   -255911.19
 [2,]    -630.9007     50.61723     -8244.645    -1792.854    -18920.91    -4020.487     3733.679      408.1092    -4471.714    -43321.68    -13359.91
 [3,] -244576.1810  -8244.64481   6811241.996  -663553.683  -5999899.80 -1485590.582  1332873.508   145843.5273 -1577639.867 -15279797.40  -4441321.43
 [4,]  -56081.1172  -1792.85433   -663553.683   322746.524  -1191458.53  -324350.637   284883.719    31287.1184  -335166.066  -3246729.73   -922191.34
 [5,] -307429.6940 -18920.90830  -5999899.796 -1191458.532  14622215.90 -2763763.920  2001658.701   222632.0981 -2236937.808 -21665597.83  -5505326.64
 [6,] -122511.5861  -4020.48687  -1485590.582  -324350.637  -2763763.92  1618649.512   643436.593    70571.4138  -758907.288  -7351411.03  -2106891.06
 [7,]   88146.8769   3733.67887   1332873.508   284883.719   2001658.70   643436.593 -8864046.098 -6169409.3513   939114.042   9071834.66   1782490.60
 [8,]    9745.3705    408.10916    145843.527    31287.118    222632.10    70571.414 -6169409.351 -2015241.9049   125368.266   1061333.06    199363.90
 [9,] -100547.4361  -4471.71425  -1577639.867  -335166.066  -2236937.81  -758907.288   939114.042   125368.2663  2137373.987  -8658448.16  -1955395.22
[10,] -974044.8940 -43321.68028 -15279797.399 -3246729.730 -21665597.83 -7351411.031  9071834.658  1061333.0628 -8658448.162 200193091.29 -18932411.83
[11,] -255911.1894 -13359.90809  -4441321.430  -922191.338  -5505326.64 -2106891.056  1782490.600   199363.8954 -1955395.219 -18932411.83  10672213.19

$`S Matrix`
             [,1]         [,2]         [,3]         [,4]        [,5]         [,6]        [,7]         [,8]        [,9]       [,10]       [,11]
 [1,]  480846.596  -33285.4279  -517074.983  -75818.5698  187334.381  -82491.4896  30892.3403  -6877.86603  5252.33672  2166913.92  127397.242
 [2,]  -33285.428    2305.1912    35980.456    5249.9458  -12974.541    5719.3563  -2136.4205    482.46000  -365.15113  -150133.07   -8833.968
 [3,] -517074.983   35980.4565   617622.572   80765.9623 -201398.589   89936.2047 -32611.3152   9213.92824 -6152.59135 -2319009.64 -138006.875
 [4,]  -75818.570    5249.9458    80765.962   12010.9695  -29596.704   13035.5096  -4881.6800   1053.98542  -837.72610  -343621.00  -20295.191
 [5,]  187334.381  -12974.5411  -201398.589  -29596.7041   73110.216  -32218.6022  12045.8636  -2679.20656  2051.82081   844844.67   49746.786
 [6,]  -82491.490    5719.3563    89936.205   13035.5096  -32218.602   14238.4295  -5289.0256   1221.10009  -913.55726  -373444.59  -22021.927
 [7,]   30892.340   -2136.4205   -32611.315   -4881.6800   12045.864   -5289.0256   2008.3374   -428.97315   320.28818   138930.60    8026.515
 [8,]   -6877.866     482.4600     9213.928    1053.9854   -2679.207    1221.1001   -428.9732    190.00734   -52.62955   -31932.26   -1625.998
 [9,]    5252.337    -365.1511    -6152.591    -837.7261    2051.821    -913.5573    320.2882    -52.62955   105.95322    22968.96    1740.374
[10,] 2166913.920 -150133.0715 -2319009.637 -343620.9966  844844.666 -373444.5913 138930.5956 -31932.25872 22968.96188 10351112.30  592383.903
[11,]  127397.242   -8833.9681  -138006.875  -20295.1910   49746.786  -22021.9271   8026.5149  -1625.99845  1740.37375   592383.90   38219.316

> difftime(Sys.time(), StartTime)
Time difference of 2.340167 mins
>
> EBE
      ID        ETA1        ETA2         ETA3
 [1,]  1  0.09258129 -0.11191055 -0.484059194
 [2,]  2  0.30762419 -0.01629883  0.122892327
 [3,]  3  0.47077789  0.02784510 -0.026184325
 [4,]  4 -0.29514424 -0.06347956  0.009206709
 [5,]  5 -0.05884094 -0.19556502 -0.013854107
 [6,]  6 -0.25006092  0.25614388  0.056171209
 [7,]  7 -0.71426902  0.06095124  0.042121009
 [8,]  8  0.08350052  0.13274633 -0.042028773
 [9,]  9  1.42793766  0.16997674 -0.031115889
[10,] 10 -0.62956029 -0.21494962 -0.208761938
[11,] 11  0.91718170  0.15725454  0.085353144
[12,] 12 -0.59666954 -0.28106733  0.138733053
>
